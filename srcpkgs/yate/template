# Template file for 'yate'
pkgname=yate
version=6.4.0
revision=1
_commit=a9632e0e8f04189a32bea5763f0aaa1428e3aee0
build_style=gnu-configure
configure_args="--without-libqt4"
make_install_target="install-noapi"
hostmakedepends="pkg-config autoconf automake which"
makedepends="speex-devel ptlib-devel h323plus-devel libilbc-devel lksctp-tools-devel
 libgsm-devel spandsp-devel alsa-lib-devel libusb-devel zlib-devel openssl-devel
 sqlite-devel postgresql-libs-devel"
short_desc="Yet Another Telephony Engine"
maintainer="classabbyamp <void@placeviolette.net>"
license="GPL-2.0-or-later"
homepage="https://www.yate.ro/"
distfiles="https://github.com/yatevoip/yate/archive/${_commit}.tar.gz"
checksum=a2dffeb0c5d093a6785ec536acd8896cf9e5bd20813ef302bcef503eba35a2cd

system_accounts="_yate"
_yate_homedir="/var/lib/yate"

make_dirs="/var/lib/yate 0750 _yate _yate"
conf_files="/etc/yate/*.conf"

if [ "$XBPS_TARGET_LIBC" = musl ]; then
	CFLAGS="-DPTHREAD_MUTEX_RECURSIVE_NP=PTHREAD_MUTEX_RECURSIVE"
fi

case "$XBPS_TARGET_ARCH" in
	x86_64*|i686*) configure_args+=" --enable-sse2" ;;
esac

pre_configure() {
	./autogen.sh
}

post_install() {
	vsv yate
	# no qt4 ui, useless
	rm -r "${DESTDIR}/usr/share/yate/skins"
}

yate-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/bin/yate-config
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.so"
	}
}
