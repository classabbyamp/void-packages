# Template file for 'motionplus'
pkgname=motionplus
version=0.2.1
revision=1
build_style=gnu-configure
configure_args="--sysconfdir=/etc"
hostmakedepends="automake gettext-devel-tools pkgconf"
makedepends="gettext-devel libjpeg-turbo-devel libmicrohttpd-devel ffmpeg-devel
 libcamera-devel libopencv-devel sqlite-devel alsa-lib-devel pulseaudio-devel
 fftw-devel libwebp-devel"
short_desc="Monitor and record video signals from many types of cameras"
maintainer="classabbyamp <void@placeviolette.net>"
license="GPL-3.0-or-later"
homepage="https://motion-project.github.io"
changelog="https://github.com/Motion-Project/motionplus/releases"
distfiles="https://github.com/Motion-Project/motionplus/archive/refs/tags/release-${version}.tar.gz"
checksum=5f1d8ba14e476e0c905dc989ad884640d1e154adcb8d7aec9e340f1c529c8bcb
conf_files="/etc/motionplus/motionplus.conf"
make_dirs="/var/lib/motionplus 755 _motionplus _motionplus"
system_accounts="_motionplus"
_motionplus_homedir="/var/lib/motionplus"
_motionplus_groups="audio,video"

post_patch() {
	vsed -i -e 's|@prefix@/etc|/etc|g' data/*.conf.in
}

pre_configure() {
	autoreconf -fi
}

post_install() {
	vmkdir usr/share/examples/motionplus
	mv "${DESTDIR}"/etc/motionplus/*dist* "${DESTDIR}"/usr/share/examples/motionplus
	cp "${DESTDIR}"/usr/share/examples/motionplus/motionplus-dist.conf \
		"${DESTDIR}"/etc/motionplus/motionplus.conf
	vsv motionplus
}
